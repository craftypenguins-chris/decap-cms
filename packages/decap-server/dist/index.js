#!/usr/bin/env node
(()=>{"use strict";var e={96:e=>{e.exports=require("morgan")},123:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.readMediaFile=t.entriesFromFiles=void 0;const i=r(a(982)),n=r(a(928)),s=a(896);function o(e){return i.default.createHash("sha256").update(e).digest("hex")}function l(e){return e.replace(/\\/g,"/")}t.entriesFromFiles=async function(e,t){return Promise.all(t.map(async t=>{try{const a=await s.promises.readFile(n.default.join(e,t.path));return{data:a.toString(),file:{path:l(t.path),label:t.label,id:o(a)}}}catch(e){return{data:null,file:{path:l(t.path),label:t.label,id:null}}}}))},t.readMediaFile=async function(e,t){const a="base64",r=await s.promises.readFile(n.default.join(e,t));return{id:o(r),content:r.toString(a),encoding:a,path:l(t),name:n.default.basename(t)}}},124:e=>{e.exports=require("winston")},161:(e,t)=>{function a(e){return e||"decap-cms/"}Object.defineProperty(t,"__esModule",{value:!0}),t.branchFromContentKey=t.contentKeyFromBranch=t.parseContentKey=t.generateContentKey=t.statusToLabel=t.labelToStatus=t.isCMSLabel=t.MERGE_COMMIT_MESSAGE=t.DEFAULT_PR_BODY=t.CMS_BRANCH_PREFIX=void 0,t.CMS_BRANCH_PREFIX="cms",t.DEFAULT_PR_BODY="Automatically generated by Decap CMS",t.MERGE_COMMIT_MESSAGE="Automatically generated. Merged on Decap CMS.",t.isCMSLabel=function(e,t){return e.startsWith(a(t))},t.labelToStatus=function(e,t){return e.slice(a(t).length)},t.statusToLabel=function(e,t){return`${a(t)}${e}`},t.generateContentKey=function(e,t){return`${e}/${t}`},t.parseContentKey=function(e){const t=e.indexOf("/");return{collection:e.slice(0,t),slug:e.slice(t+1)}},t.contentKeyFromBranch=function(e){return e.slice(`${t.CMS_BRANCH_PREFIX}/`.length)},t.branchFromContentKey=function(e){return`${t.CMS_BRANCH_PREFIX}/${e}`}},252:e=>{e.exports=require("express")},280:e=>{e.exports=require("what-the-diff")},354:e=>{e.exports=require("async-mutex")},476:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getUpdateDate=t.move=t.deleteFile=t.writeFile=t.listDirChildren=t.listRepoFiles=void 0;const r=a(928),i=a(896).promises;async function n(e,t,a){if(a<=0)return[];try{const s=await i.readdir(e,{withFileTypes:!0}),o=await Promise.all(s.map(i=>{const s=r.join(e,i.name);return i.isDirectory()?n(s,t,a-1):[s].filter(e=>e.endsWith(t))}));return[].concat(...o)}catch(e){return[]}}async function s(e,t){await i.mkdir(r.dirname(t),{recursive:!0}),await i.rename(e,t)}t.listRepoFiles=async function(e,t,a,i){const s=r.join(e,t);return(await n(s,a,i)).map(t=>t.slice(e.length+1))},t.listDirChildren=async function(e,t){const a=r.join(e,t);try{return(await i.readdir(a,{withFileTypes:!0})).map(t=>{const i=r.join(a,t.name).slice(e.length+1);return{type:t.isDirectory()?"directory":"file",path:i,name:t.name}})}catch(e){return[]}},t.writeFile=async function(e,t){await i.mkdir(r.dirname(e),{recursive:!0}),await i.writeFile(e,t)},t.deleteFile=async function(e,t){await i.unlink(r.join(e,t)).catch(()=>{})},t.move=async function(e,t){await s(e,t);const a=r.dirname(e),i=r.dirname(t),o=await n(a,"",100);await Promise.all(o.map(e=>s(e,e.replace(a,i))))},t.getUpdateDate=async function(e,t){return i.stat(r.join(e,t)).then(e=>e.mtime).catch(()=>new Date)}},577:e=>{e.exports=require("cors")},669:e=>{e.exports=require("@hapi/joi")},778:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.pathTraversal=void 0;const i=r(a(669)),n=r(a(928));t.pathTraversal=function(e){return i.default.extend({type:"path",base:i.default.string().required(),messages:{"path.invalid":"{{#label}} must resolve to a path under the configured repository"},validate(t,a){if(!n.default.join(e,t).startsWith(e))return{value:t,errors:a.error("path.invalid")}}}).path()}},783:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),a(818).config();const i=r(a(252)),n=a(827),s=a(971),o=a(786),l=a(943),c=(0,i.default)(),d=Number(process.env.PORT)||8081,u=process.env.HOST||"0.0.0.0",p=process.env.LOG_LEVEL||"info";(async()=>{const e=(0,l.createLogger)({level:p});try{e.info("[DecapServer] version srv-2025-09-20-01")}catch(e){}const t={logger:e};(0,n.registerCommonMiddlewares)(c,t);try{const e=process.env.MODE||"fs";if("fs"===e)(0,o.registerMiddleware)(c,t);else{if("git"!==e)throw new Error(`Unknown proxy mode '${e}'`);(0,s.registerMiddleware)(c,t)}}catch(t){e.error(t instanceof Error?t.message:"Unknown error"),process.exit(1)}c.listen(d,u,()=>{e.info(`Decap CMS Proxy Server listening on ${u}:${d}`)})})()},786:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.registerMiddleware=t.getSchema=t.localFsMiddleware=void 0;const i=r(a(928)),n=a(964),s=a(778),o=a(476),l=a(123);function c({repoPath:e,logger:t}){return async function(a,r){try{const{body:n}=a;try{t.debug(`[fs] action=${n.action}`)}catch(e){}switch(n.action){case"info":r.json({repo:i.default.basename(e),publish_modes:["simple"],type:"local_fs"});break;case"entriesByFolder":{const t=n.params,{folder:a,extension:i,depth:s}=t,c=await(0,o.listRepoFiles)(e,a,i,s).then(t=>(0,l.entriesFromFiles)(e,t.map(e=>({path:e}))));r.json(c);break}case"entriesByFiles":{const t=n.params,a=await(0,l.entriesFromFiles)(e,t.files);r.json(a);break}case"getEntry":{const t=n.params,[a]=await(0,l.entriesFromFiles)(e,[{path:t.path}]);r.json(a);break}case"persistEntry":{const{entry:a,dataFiles:s=[a],assets:l}=n.params;try{t.info(`[fs] persistEntry dataFiles=${s.length} assets=${l.length}`)}catch(e){}await Promise.all(s.map(t=>(0,o.writeFile)(i.default.join(e,t.path),t.raw))),await Promise.all(l.map(t=>(0,o.writeFile)(i.default.join(e,t.path),Buffer.from(t.content,t.encoding)))),s.every(e=>e.newPath)&&s.forEach(async t=>{await(0,o.move)(i.default.join(e,t.path),i.default.join(e,t.newPath))});try{t.debug("[fs] persistEntry complete")}catch(e){}r.json({message:"entry persisted"});break}case"getMedia":{const{mediaFolder:a,subpath:s=""}=n.params,c=i.default.resolve(e,a),d=i.default.normalize(s||"").replace(/^\\+|\/+$/g,"");if(d.includes(".."))return r.status(400).json({error:"Invalid subpath"});const u=i.default.resolve(c,d),p=c.endsWith(i.default.sep)?c:c+i.default.sep;if(u!==c&&!u.startsWith(p))return r.status(400).json({error:"Invalid subpath"});const f=i.default.relative(e,u),h=await(0,o.listDirChildren)(e,f),m=h.filter(e=>"file"===e.type).map(e=>e.path),g=h.filter(e=>"directory"===e.type),y=await Promise.all(m.map(t=>(0,l.readMediaFile)(e,t))),w=g.map(e=>({id:e.path,name:e.name,path:e.path,type:"directory",content:"",encoding:"base64"}));try{t.debug(`[fs] getMedia mediaFolder=${a} subpath=${d} dirs=${g.length} files=${m.length}`)}catch(e){}r.json([...w,...y]);break}case"getMediaFile":{const{path:a}=n.params;try{t.debug(`[fs] getMediaFile path=${a}`)}catch(e){}const i=await(0,l.readMediaFile)(e,a);r.json(i);break}case"persistMedia":{const{asset:a}=n.params;try{t.info(`[fs] persistMedia path=${a.path} bytes=${a.content&&a.content.length||0} encoding=${a.encoding}`)}catch(e){}await(0,o.writeFile)(i.default.join(e,a.path),Buffer.from(a.content,a.encoding));const s=await(0,l.readMediaFile)(e,a.path);try{t.debug("[fs] persistMedia complete")}catch(e){}r.json(s);break}case"deleteFile":{const{path:t}=n.params;await(0,o.deleteFile)(e,t),r.json({message:`deleted file ${t}`});break}case"deleteFiles":{const{paths:t}=n.params;await Promise.all(t.map(t=>(0,o.deleteFile)(e,t))),r.json({message:`deleted files ${t.join(", ")}`});break}case"getDeployPreview":r.json(null);break;default:{const e=`Unknown action ${n.action}`;r.status(422).json({error:e});break}}}catch(e){t.error(`Error handling ${JSON.stringify(a.body)}: ${e instanceof Error?e.message:"Unknown error"}`),r.status(500).json({error:"Unknown error"})}}}function d({repoPath:e}){return(0,n.defaultSchema)({path:(0,s.pathTraversal)(e)})}t.localFsMiddleware=c,t.getSchema=d,t.registerMiddleware=async function(e,t){const{logger:a}=t,r=i.default.resolve(process.env.GIT_REPO_DIRECTORY||process.cwd());e.post("/api/v1",(0,n.joi)(d({repoPath:r}))),e.post("/api/v1",c({repoPath:r,logger:a})),a.info(`Decap CMS File System Proxy Server configured with ${r}`)}},807:e=>{e.exports=require("simple-git")},818:e=>{e.exports=require("dotenv")},827:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.registerCommonMiddlewares=void 0;const i=r(a(252)),n=r(a(96)),s=r(a(577));t.registerCommonMiddlewares=function(e,t){const{logger:a}=t,r={write:e=>{a.debug(String(e).trim())}};e.use((0,n.default)("combined",{stream:r})),e.use((0,s.default)()),e.use(i.default.json({limit:"50mb"}))}},896:e=>{e.exports=require("fs")},928:e=>{e.exports=require("path")},943:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createLogger=void 0;const i=r(a(124)),{combine:n,colorize:s,simple:o}=i.default.format;t.createLogger=function({level:e}){return i.default.createLogger({level:e,format:n(s(),o()),transports:[new i.default.transports.Console]})}},964:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.joi=t.defaultSchema=void 0;const i=r(a(669)),n=["info","entriesByFolder","entriesByFiles","getEntry","unpublishedEntries","unpublishedEntry","unpublishedEntryDataFile","unpublishedEntryMediaFile","deleteUnpublishedEntry","persistEntry","updateUnpublishedEntryStatus","publishUnpublishedEntry","getMedia","getMediaFile","persistMedia","deleteFile","deleteFiles","getDeployPreview"],s=i.default.string().required(),o=i.default.number().required(),l=i.default.bool().required(),c=s,d=s;t.defaultSchema=function({path:e=s}={}){const t=i.default.object({branch:s}),a=i.default.object({path:e,content:s,encoding:s.valid("base64")}),r=i.default.object({slug:s,path:e,raw:s,newPath:e.optional()}),u=i.default.when("action",{switch:[{is:"info",then:i.default.allow()},{is:"entriesByFolder",then:t.keys({folder:e,extension:s,depth:o}).required()},{is:"entriesByFiles",then:t.keys({files:i.default.array().items(i.default.object({path:e,label:i.default.string()})).required()})},{is:"getEntry",then:t.keys({path:e}).required()},{is:"unpublishedEntries",then:t.keys({branch:s}).required()},{is:"unpublishedEntry",then:t.keys({id:i.default.string().optional(),collection:i.default.string().optional(),slug:i.default.string().optional(),cmsLabelPrefix:i.default.string().optional()}).required()},{is:"unpublishedEntryDataFile",then:t.keys({collection:c,slug:d,id:s,path:s}).required()},{is:"unpublishedEntryMediaFile",then:t.keys({collection:c,slug:d,id:s,path:s}).required()},{is:"deleteUnpublishedEntry",then:t.keys({collection:c,slug:d}).required()},{is:"persistEntry",then:t.keys({cmsLabelPrefix:i.default.string().optional(),entry:r,dataFiles:i.default.array().items(r),assets:i.default.array().items(a).required(),options:i.default.object({collectionName:i.default.string(),commitMessage:s,useWorkflow:l,status:s}).required()}).xor("entry","dataFiles").required()},{is:"updateUnpublishedEntryStatus",then:t.keys({collection:c,slug:d,newStatus:s,cmsLabelPrefix:i.default.string().optional()}).required()},{is:"publishUnpublishedEntry",then:t.keys({collection:c,slug:d}).required()},{is:"getMedia",then:t.keys({mediaFolder:e}).required()},{is:"getMediaFile",then:t.keys({path:e}).required()},{is:"persistMedia",then:t.keys({asset:a.required(),options:i.default.object({commitMessage:s}).required()}).required()},{is:"deleteFile",then:t.keys({path:e,options:i.default.object({commitMessage:s}).required()}).required()},{is:"deleteFiles",then:t.keys({paths:i.default.array().items(e).min(1).required(),options:i.default.object({commitMessage:s}).required()}).required()},{is:"getDeployPreview",then:t.keys({collection:c,slug:d}).required()}],otherwise:i.default.forbidden()});return i.default.object({action:i.default.valid(...n).required(),params:u})},t.joi=function(e){return(t,a,r)=>{const{error:i}=e.validate(t.body,{allowUnknown:!0});if(i){const{details:e}=i,t=e.map(e=>e.message).join(",");a.status(422).json({error:t})}else r()}}},971:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.registerMiddleware=t.localGitMiddleware=t.getSchema=t.validateRepo=void 0;const i=r(a(928)),n=a(896),s=a(161),o=a(280),l=r(a(807)),c=a(354),d=a(964),u=a(778),p=a(476),f=a(123);async function h(e,t){await e.add("."),await e.commit(t,void 0,{"--no-verify":null,"--no-gpg-sign":null})}async function m(e){return await e.branchLocal().then(e=>e.current)}async function g(e,t,a){const r=await m(e);try{return r!==t&&await e.checkout(t),await a()}finally{await e.checkout(r)}}function y(e){return`branch.${e}.description`}async function w(e,t,a,r,n){await Promise.all(a.map(e=>(0,p.writeFile)(i.default.join(t,e.path),e.raw))),await Promise.all(r.map(e=>(0,p.writeFile)(i.default.join(t,e.path),Buffer.from(e.content,e.encoding)))),a.every(e=>e.newPath)&&a.forEach(async e=>{await(0,p.move)(i.default.join(t,e.path),i.default.join(t,e.newPath))}),await h(e,n)}async function b(e,t){return await e.branchLocal().then(({all:e})=>e.includes(t))}async function F(e,t,a){const r=await e.diff([t,a]);return(0,o.parse)(r).map(e=>{var t,a;const r=(null===(t=e.oldPath)||void 0===t?void 0:t.replace(/b\//,""))||"",i=(null===(a=e.newPath)||void 0===a?void 0:a.replace(/b\//,""))||"",n=i||r;return{oldPath:r,newPath:i,status:e.status,newFile:"added"===e.status,path:n,id:n,binary:e.binary||/.svg$/.test(n)}})}async function v({repoPath:e}){const t=(0,l.default)(e);if(!await t.checkIsRepo())throw Error(`${e} is not a valid git repository`)}function M({repoPath:e}){return(0,d.defaultSchema)({path:(0,u.pathTraversal)(e)})}function j({repoPath:e,logger:t}){const a=(0,l.default)(e),r=(0,c.withTimeout)(new c.Mutex,3e3,new Error("Request timed out"));return async function(o,l){let c;try{c=await r.acquire();const{body:d}=o;if("info"===d.action)return void l.json({repo:i.default.basename(e),publish_modes:["simple","editorial_workflow"],type:"local_git"});const{branch:u}=d.params;if(!await b(a,u)){const e=`Default branch '${u}' doesn't exist`;return void l.status(422).json({error:e})}switch(d.action){case"entriesByFolder":{const t=d.params,{folder:r,extension:i,depth:n}=t,s=await g(a,u,()=>(0,p.listRepoFiles)(e,r,i,n).then(t=>(0,f.entriesFromFiles)(e,t.map(e=>({path:e})))));l.json(s);break}case"entriesByFiles":{const t=d.params,r=await g(a,u,()=>(0,f.entriesFromFiles)(e,t.files));l.json(r);break}case"getEntry":{const t=d.params,[r]=await g(a,u,()=>(0,f.entriesFromFiles)(e,[{path:t.path}]));l.json(r);break}case"unpublishedEntries":{const e=await a.branchLocal().then(e=>e.all.filter(e=>e.startsWith(`${s.CMS_BRANCH_PREFIX}/`)));l.json(e.map(s.contentKeyFromBranch));break}case"unpublishedEntry":{let{id:t,collection:r,slug:i,cmsLabelPrefix:n}=d.params;t&&({collection:r,slug:i}=(0,s.parseContentKey)(t));const o=(0,s.generateContentKey)(r,i),c=(0,s.branchFromContentKey)(o);if(!await b(a,c))return l.status(404).json({message:"Not Found"});{const t=await F(a,u,c),o=await a.raw(["config",y(c)]),d=o&&(0,s.labelToStatus)(o.trim(),n||""),f=t.length>=0?await g(a,c,async()=>(await Promise.all(t.map(({newPath:t})=>(0,p.getUpdateDate)(e,t)))).reduce((e,t)=>e>t?e:t)):new Date,h={collection:r,slug:i,status:d,diffs:t,updatedAt:f};l.json(h)}break}case"unpublishedEntryDataFile":{const{path:t,collection:r,slug:i}=d.params,n=(0,s.generateContentKey)(r,i),o=(0,s.branchFromContentKey)(n),[c]=await g(a,o,()=>(0,f.entriesFromFiles)(e,[{path:t}]));l.json({data:c.data});break}case"unpublishedEntryMediaFile":{const{path:t,collection:r,slug:i}=d.params,n=(0,s.generateContentKey)(r,i),o=(0,s.branchFromContentKey)(n),c=await g(a,o,()=>(0,f.readMediaFile)(e,t));l.json(c);break}case"deleteUnpublishedEntry":{const{collection:e,slug:t}=d.params,r=(0,s.generateContentKey)(e,t),i=(0,s.branchFromContentKey)(r);await m(a)===i&&await a.checkoutLocalBranch(u),await a.branch(["-D",i]),l.json({message:`deleted branch: ${i}`});break}case"persistEntry":{const{cmsLabelPrefix:r,entry:o,dataFiles:c=[o],assets:p,options:f}=d.params;try{t.info(`[git] persistEntry dataFiles=${c.length} assets=${p.length} useWorkflow=${f.useWorkflow} status=${f.status}`)}catch(e){}if(f.useWorkflow){const t=c[0].slug,o=f.collectionName,l=(0,s.generateContentKey)(o,t),d=(0,s.branchFromContentKey)(l);await g(a,u,async()=>{const t=await b(a,d);t?await a.checkout(d):await a.checkoutLocalBranch(d),await async function(e,t){const a=await e.raw(["config","commit.gpgsign"]);try{"true"===a&&await e.addConfig("commit.gpgsign","false"),await e.rebase([t,"--no-verify"])}finally{"true"===a&&await e.addConfig("commit.gpgsign",a)}}(a,u);const o=(await F(a,u,d)).filter(e=>e.binary&&!p.map(e=>e.path).includes(e.path));if(await Promise.all(o.map(t=>n.promises.unlink(i.default.join(e,t.path)))),await w(a,e,c,p,f.commitMessage),!t){const e=(0,s.statusToLabel)(f.status,r||"");await a.addConfig(y(d),e)}})}else await g(a,u,async()=>{await w(a,e,c,p,f.commitMessage)});try{t.debug("[git] persistEntry complete")}catch(e){}l.json({message:"entry persisted"});break}case"updateUnpublishedEntryStatus":{const{collection:e,slug:t,newStatus:r,cmsLabelPrefix:i}=d.params,n=(0,s.generateContentKey)(e,t),o=(0,s.branchFromContentKey)(n),c=(0,s.statusToLabel)(r,i||"");await a.addConfig(y(o),c),l.json({message:`${u} description was updated to ${c}`});break}case"publishUnpublishedEntry":{const{collection:e,slug:t}=d.params,r=(0,s.generateContentKey)(e,t),i=(0,s.branchFromContentKey)(r);await async function(e,t,a){const r=await e.raw(["config","commit.gpgsign"]);try{"true"===r&&await e.addConfig("commit.gpgsign","false"),await e.mergeFromTo(t,a)}finally{"true"===r&&await e.addConfig("commit.gpgsign",r)}}(a,i,u),await a.deleteLocalBranch(i),l.json({message:`branch ${i} merged to ${u}`});break}case"getMedia":{const{mediaFolder:r,subpath:n=""}=d.params;try{t.debug(`[git] getMedia mediaFolder=${r} subpath=${n}`)}catch(e){}const s=await g(a,u,async()=>{const a=i.default.resolve(e,r),s=i.default.normalize(n||"").replace(/^\/+|\/+$/g,""),o=i.default.resolve(a,s),l=a.endsWith(i.default.sep)?a:a+i.default.sep;if(o!==a&&!o.startsWith(l))throw new Error("Invalid subpath");const c=i.default.relative(e,o),d=await(0,p.listDirChildren)(e,c),u=d.filter(e=>"file"===e.type).map(e=>e.path),h=d.filter(e=>"directory"===e.type),m=await Promise.all(u.map(t=>(0,f.readMediaFile)(e,t))),g=h.map(e=>({id:e.path,name:e.name,path:e.path,type:"directory",content:"",encoding:"base64"}));try{t.debug(`[git] getMedia results dirs=${h.length} files=${u.length}`)}catch(e){}return[...g,...m]});l.json(s);break}case"getMediaFile":{const{path:r}=d.params;try{t.debug(`[git] getMediaFile path=${r}`)}catch(e){}const i=await g(a,u,()=>(0,f.readMediaFile)(e,r));l.json(i);break}case"persistMedia":{const{asset:r,options:{commitMessage:n}}=d.params;try{t.info(`[git] persistMedia path=${r.path} bytes=${r.content&&r.content.length||0} encoding=${r.encoding}`)}catch(e){}const s=await g(a,u,async()=>(await(0,p.writeFile)(i.default.join(e,r.path),Buffer.from(r.content,r.encoding)),await h(a,n),(0,f.readMediaFile)(e,r.path)));try{t.debug("[git] persistMedia complete")}catch(e){}l.json(s);break}case"deleteFile":{const{path:t,options:{commitMessage:r}}=d.params;await g(a,u,async()=>{await(0,p.deleteFile)(e,t),await h(a,r)}),l.json({message:`deleted file ${t}`});break}case"deleteFiles":{const{paths:t,options:{commitMessage:r}}=d.params;await g(a,u,async()=>{await Promise.all(t.map(t=>(0,p.deleteFile)(e,t))),await h(a,r)}),l.json({message:`deleted files ${t.join(", ")}`});break}case"getDeployPreview":l.json(null);break;default:{const e=`Unknown action ${d.action}`;l.status(422).json({error:e});break}}}catch(e){t.error(`Error handling ${JSON.stringify(o.body)}: ${e instanceof Error?e.message:"Unknown error"}`),l.status(500).json({error:"Unknown error"})}finally{c&&c()}}}t.validateRepo=v,t.getSchema=M,t.localGitMiddleware=j,t.registerMiddleware=async function(e,t){const{logger:a}=t,r=i.default.resolve(process.env.GIT_REPO_DIRECTORY||process.cwd());await v({repoPath:r}),e.post("/api/v1",(0,d.joi)(M({repoPath:r}))),e.post("/api/v1",j({repoPath:r,logger:a})),a.info(`Decap CMS Git Proxy Server configured with ${r}`)}},982:e=>{e.exports=require("crypto")}},t={},a=function a(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,a),n.exports}(783);module.exports=a})();
//# sourceMappingURL=index.js.map